{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block content %}
<div class="site-section bg-light">
  <div class="container">
    <div class="row align-items-stretch retro-layout-2">
      <div class="col-md-8">
        Select the topic you wish to listen to:
        <br />
        <input type="button" value="Refresh topics" onclick="socket.emit('topic_list', null, populateTopics)" />
        <select id="topicSelector" ,
          onchange="socket.emit('subscribe', {'topic': this.options[this.selectedIndex].text, 'type': this.value})">
        </select>
      </div>
      <div class="col-md-8">
        <pre id="topicViewer"></pre>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript" charset="utf-8">
  var socket = io();

  socket.on("dynamic_topic", function (msg) {
    var topicView = document.getElementById("topicViewer");
    topicView.innerHTML = "Last updated:" + new Date().toLocaleTimeString() + "\n" + JSON.stringify(msg, null, 4);
  });

  function populateTopics(topics) {
    var topicSelect = document.getElementById("topicSelector");
    topicSelect.innerHTML = "";

    for (var i = 0; i < topics.length; i++) {
      var el = document.createElement("option");
      el.textContent = topics[i][0];
      el.value = topics[i][1];
      topicSelect.appendChild(el);
    }
  }
</script>
{% endblock %}